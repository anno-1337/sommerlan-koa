# Javascript Node CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-javascript/ for more details
#
version: 2
jobs:
  build-docker-image:
    machine: true
    woring-directory: ~/repo
    steps:
      # build docker image
      - checkout
      - run: docker build -t sommerlan@anno1337.com .
      - run: docker tag playmorepromode.com fjoggs/sommerlan@anno1337.com:latest
      - run: docker login -u $DOCKER_USER -p $DOCKER_PASS
      - run: docker push fjoggs/sommerlan@anno1337.com:latest
    machine: true
    steps:
      - add_ssh_keys:
          fingerprints:
            - "79:b4:12:1e:cc:40:05:11:c6:a1:df:e7:10:37:ca:49"
      - attach_workspace:
          at: ~/tmp/repo
      - run: ssh fjoggs@anno1337.com '/home/fjoggs/scripts/continous-deployment-sommerlan-koa.sh'
workflows:
  version: 2
  build-and-deploy:
    jobs:
      - build-docker-image
      - deploy:
          requires:
            - build-docker-image
          filters:
            branches:
              only: 
                - master
